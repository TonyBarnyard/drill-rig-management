<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drill Rig Management System - Pilgangoora</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useEffect } = React;
    const e = React.createElement;

    const DrillRigManagementSystem = () => {
      const [currentPage, setCurrentPage] = useState('fleet');
      const [selectedRig, setSelectedRig] = useState('DR201');
      const [adminMode, setAdminMode] = useState(false);
      const [adminLoginAttempt, setAdminLoginAttempt] = useState('');
      const [showPasswordPrompt, setShowPasswordPrompt] = useState(false);
      const [showForgotPassword, setShowForgotPassword] = useState(false);
      const [showSetupSecurity, setShowSetupSecurity] = useState(false);

      // Security Setup
      const [securitySetup, setSecuritySetup] = useState(() => {
        const saved = localStorage.getItem('adminSecuritySetup');
        return saved ? JSON.parse(saved) : { 
          setupComplete: false,
          securityQuestion: '', 
          securityAnswer: '',
          recoveryCode: '',
          email: ''
        };
      });

      const [recoveryAttempt, setRecoveryAttempt] = useState({
        securityAnswer: '',
        recoveryCode: ''
      });

      const [recoveryStep, setRecoveryStep] = useState(1);
      const [newPasswordSetup, setNewPasswordSetup] = useState('');
      const [confirmPasswordSetup, setConfirmPasswordSetup] = useState('');
      const [adminPassword, setAdminPassword] = useState('admin123');

      // Production Data
      const [productionData, setProductionData] = useState(() => {
        const saved = localStorage.getItem('productionData');
        return saved ? JSON.parse(saved) : {};
      });

      const fleet = {
        'DR201': { model: 'D65', location: 'Collar Zone', type: 'D65', status: 'Active', hoursRunning: 2847, depthCapacity: 1200, hoistCapacity: 300 },
        'DR202': { model: 'D65', location: 'Overburden', type: 'D65', status: 'Active', hoursRunning: 2934, depthCapacity: 1200, hoistCapacity: 300 },
        'DR203': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 3102, depthCapacity: 1200, hoistCapacity: 300 },
        'DR204': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2756, depthCapacity: 1200, hoistCapacity: 300 },
        'DR205': { model: 'D65', location: 'Production', type: 'D65', status: 'Standby', hoursRunning: 1829, depthCapacity: 1200, hoistCapacity: 300 },
        'DR206': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2645, depthCapacity: 1200, hoistCapacity: 300 },
        'DR207': { model: 'D65', location: 'Wall Control', type: 'D65', status: 'Active', hoursRunning: 2234, depthCapacity: 1200, hoistCapacity: 300 },
        'DR208': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2987, depthCapacity: 1200, hoistCapacity: 300 },
        'DR209': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 3045, depthCapacity: 1200, hoistCapacity: 300 },
        'DR210': { model: 'D65', location: 'Deep Prod', type: 'D65', status: 'Active', hoursRunning: 2123, depthCapacity: 1200, hoistCapacity: 300 },
        'DR211': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2876, depthCapacity: 1200, hoistCapacity: 300 },
        'DR212': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2645, depthCapacity: 1200, hoistCapacity: 300 },
        'DR213': { model: 'D65', location: 'Production', type: 'D65', status: 'Active', hoursRunning: 2734, depthCapacity: 1200, hoistCapacity: 300 },
        'DR214': { model: 'D65', location: 'Wall Control', type: 'D65', status: 'Maintenance', hoursRunning: 1456, depthCapacity: 1200, hoistCapacity: 300 },
      };

      const rigSpecs = {
        'D65': {
          drillStringAssemblies: {
            'Production with Shock Sub': {
              components: [
                { id: 1, name: 'SCS Assembly', type: 'Spindle', specs: { od: '65mm', id: '40mm', length: '150mm', weight: '45kg' } },
                { id: 2, name: 'Saver Sub', type: 'Connection', specs: { od: '50mm', id: '35mm', length: '80mm', weight: '12kg' } },
                { id: 3, name: 'Shock Sub', type: 'Damping', specs: { od: '50mm', id: '35mm', length: '100mm', weight: '15kg' } },
                { id: 4, name: 'Drill Pipe', type: 'Pipe', specs: { od: '73mm', id: '56mm', length: '6000mm', weight: '85kg' } },
                { id: 5, name: 'Drill Collar', type: 'Collar', specs: { od: '127mm', id: '50mm', length: '6000mm', weight: '320kg' } },
                { id: 6, name: 'Hammer', type: 'Bit', specs: { od: '70mm', id: '45mm', length: '200mm', weight: '25kg' } },
                { id: 7, name: 'Bit', type: 'Bit', specs: { od: '76mm', id: '32mm', length: '120mm', weight: '18kg' } }
              ]
            },
            'Production Standard': {
              components: [
                { id: 1, name: 'SCS Assembly', type: 'Spindle', specs: { od: '65mm', id: '40mm', length: '150mm', weight: '45kg' } },
                { id: 2, name: 'Saver Sub', type: 'Connection', specs: { od: '50mm', id: '35mm', length: '80mm', weight: '12kg' } },
                { id: 3, name: 'Drill Pipe', type: 'Pipe', specs: { od: '73mm', id: '56mm', length: '6000mm', weight: '85kg' } },
                { id: 4, name: 'Drill Collar', type: 'Collar', specs: { od: '127mm', id: '50mm', length: '6000mm', weight: '320kg' } },
                { id: 5, name: 'Hammer', type: 'Bit', specs: { od: '70mm', id: '45mm', length: '200mm', weight: '25kg' } },
                { id: 6, name: 'Bit', type: 'Bit', specs: { od: '76mm', id: '32mm', length: '120mm', weight: '18kg' } }
              ]
            }
          }
        }
      };

      const generateRecoveryCode = () => {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let code = '';
        for (let i = 0; i < 32; i++) {
          code += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return code;
      };

      const handleAdminLogin = () => {
        if (adminLoginAttempt === adminPassword) {
          setAdminMode(true);
          setShowPasswordPrompt(false);
          setAdminLoginAttempt('');
        } else {
          alert('âŒ Incorrect password');
          setAdminLoginAttempt('');
        }
      };

      const handleLogout = () => {
        setAdminMode(false);
        setAdminPassword('admin123');
      };

      const initializeSecurityQuestions = () => {
        if (!securitySetup.securityQuestion || !securitySetup.securityAnswer) {
          alert('âŒ Please enter a security question and answer');
          return;
        }
        const code = generateRecoveryCode();
        setSecuritySetup({
          setupComplete: true,
          securityQuestion: securitySetup.securityQuestion,
          securityAnswer: securitySetup.securityAnswer.toLowerCase(),
          recoveryCode: code,
          email: securitySetup.email || ''
        });
        alert(`âœ“ Security setup complete!\n\nRecovery Code:\n${code}\n\nSave this code safely!`);
        setShowSetupSecurity(false);
      };

      const handleForgotPassword = () => {
        if (recoveryStep === 1) {
          if (recoveryAttempt.securityAnswer.toLowerCase() === securitySetup.securityAnswer) {
            setRecoveryStep(2);
          } else {
            alert('âŒ Incorrect answer');
          }
        } else if (recoveryStep === 2) {
          if (recoveryAttempt.recoveryCode === securitySetup.recoveryCode) {
            setRecoveryStep(3);
          } else {
            alert('âŒ Incorrect recovery code');
          }
        } else if (recoveryStep === 3) {
          if (newPasswordSetup === confirmPasswordSetup && newPasswordSetup.length >= 6) {
            setAdminPassword(newPasswordSetup);
            alert('âœ“ Password reset successfully!');
            setShowForgotPassword(false);
            setRecoveryStep(1);
            setNewPasswordSetup('');
            setConfirmPasswordSetup('');
            setRecoveryAttempt({ securityAnswer: '', recoveryCode: '' });
          } else {
            alert('âŒ Passwords must match and be at least 6 characters');
          }
        }
      };

      useEffect(() => {
        localStorage.setItem('adminSecuritySetup', JSON.stringify(securitySetup));
      }, [securitySetup]);

      useEffect(() => {
        localStorage.setItem('productionData', JSON.stringify(productionData));
      }, [productionData]);

      // Fleet Dashboard
      const FleetDashboard = () => {
        const statusColor = (status) => {
          if (status === 'Active') return 'text-green-400';
          if (status === 'Standby') return 'text-yellow-400';
          return 'text-red-400';
        };

        return e('div', { className: 'space-y-4' },
          e('h2', { className: 'text-3xl font-bold text-blue-400 mb-6' }, 'ðŸ“Š Fleet Dashboard - Pilgangoora Site'),
          e('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
            Object.entries(fleet).map(([rigId, rig]) =>
              e('div', { 
                key: rigId,
                className: 'bg-gradient-to-br from-slate-700 to-slate-800 border border-blue-500/30 rounded-lg p-4 cursor-pointer hover:border-blue-400 hover:shadow-lg transition',
                onClick: () => { setSelectedRig(rigId); setCurrentPage('rig'); }
              },
                e('div', { className: 'font-bold text-blue-400 text-lg mb-2' }, rigId),
                e('div', { className: 'space-y-1 text-sm text-gray-300' },
                  e('div', null, `Model: ${rig.model}`),
                  e('div', null, `Location: ${rig.location}`),
                  e('div', { className: statusColor(rig.status) }, `Status: ${rig.status}`),
                  e('div', { className: 'text-green-400 font-bold' }, `Hours: ${rig.hoursRunning.toLocaleString()}`)
                ),
                e('div', { className: 'mt-3 text-xs text-blue-300' }, 'â†’ Click to view details')
              )
            )
          )
        );
      };

      // Rig Detail
      const RigDetail = () => {
        const rig = fleet[selectedRig];
        const config = rigSpecs.D65['Production with Shock Sub'];

        return e('div', { className: 'space-y-4' },
          e('button', {
            className: 'bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold',
            onClick: () => setCurrentPage('fleet')
          }, 'â† Back to Fleet'),
          e('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-4' },
            // Left column - specs
            e('div', { className: 'lg:col-span-1 space-y-4' },
              e('div', { className: 'bg-gradient-to-br from-slate-700 to-slate-800 border border-blue-500/30 rounded-lg p-6' },
                e('h2', { className: 'text-2xl font-bold text-blue-400 mb-4' }, selectedRig),
                e('div', { className: 'space-y-2 text-gray-300' },
                  e('div', null, e('span', { className: 'text-gray-400' }, 'Model: '), rig.model),
                  e('div', null, e('span', { className: 'text-gray-400' }, 'Location: '), rig.location),
                  e('div', { className: 'text-lg font-bold', style: { color: rig.status === 'Active' ? '#4ade80' : '#eab308' } }, 
                    `${rig.status}`),
                  e('div', { className: 'text-green-400' }, `Hours Running: ${rig.hoursRunning.toLocaleString()}`),
                  e('div', { className: 'mt-4 pt-4 border-t border-gray-600 space-y-2 text-sm' },
                    e('div', null, `Depth Capacity: ${rig.depthCapacity}m`),
                    e('div', null, `Hoist Capacity: ${rig.hoistCapacity}t`)
                  )
                )
              )
            ),
            // Right columns - string assembly
            e('div', { className: 'lg:col-span-2 space-y-4' },
              e('div', { className: 'bg-gradient-to-br from-slate-700 to-slate-800 border border-blue-500/30 rounded-lg p-6' },
                e('h3', { className: 'text-xl font-bold text-blue-400 mb-4' }, 'ðŸ”§ Drill String Assembly'),
                e('div', { className: 'space-y-3' },
                  config.components.map((comp, idx) =>
                    e('div', { key: idx, className: 'bg-slate-600/50 rounded p-3 border border-slate-500' },
                      e('div', { className: 'font-bold text-blue-300' }, `${idx + 1}. ${comp.name}`),
                      e('div', { className: 'text-sm text-gray-300 mt-1' },
                        `Type: ${comp.type} | OD: ${comp.specs.od} | Length: ${comp.specs.length} | Weight: ${comp.specs.weight}`
                      )
                    )
                  )
                )
              )
            )
          )
        );
      };

      // Admin Panel
      const AdminPanel = () => {
        return e('div', { className: 'space-y-4' },
          e('div', { className: 'bg-gradient-to-br from-red-900 to-red-800 border border-red-500/30 rounded-lg p-6' },
            e('h2', { className: 'text-2xl font-bold text-red-400 mb-6' }, 'âš™ï¸ Admin Settings'),
            e('div', { className: 'space-y-4' },
              !securitySetup.setupComplete && e('div', { className: 'bg-yellow-900/20 border border-yellow-500/30 p-4 rounded' },
                e('p', { className: 'text-yellow-400 mb-3 font-bold' }, 'âš ï¸ Security Not Setup'),
                e('p', { className: 'text-gray-300 text-sm mb-3' }, 'Setup security questions and recovery codes to protect your admin account'),
                e('button', {
                  className: 'w-full bg-yellow-600 hover:bg-yellow-500 text-white py-2 rounded font-bold',
                  onClick: () => setShowSetupSecurity(true)
                }, 'ðŸ” Setup Security Questions')
              ),
              securitySetup.setupComplete && e('div', { className: 'bg-green-900/20 border border-green-500/30 p-4 rounded' },
                e('p', { className: 'text-green-400 font-bold mb-2' }, 'âœ“ Security Setup Complete'),
                e('p', { className: 'text-gray-300 text-sm' }, `Question: ${securitySetup.securityQuestion}`)
              ),
              e('button', {
                className: 'w-full bg-red-600 hover:bg-red-500 text-white py-2 rounded font-bold mt-4',
                onClick: handleLogout
              }, 'ðŸšª Logout')
            )
          )
        );
      };

      // Password Prompt
      if (showPasswordPrompt) {
        return e('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4' },
          e('div', { className: 'bg-gradient-to-br from-slate-800 to-slate-900 border border-red-500/30 rounded-lg p-8 max-w-md w-full' },
            e('h2', { className: 'text-2xl font-bold text-red-400 mb-6 text-center' }, 'ðŸ”“ Admin Login'),
            e('input', {
              type: 'password',
              placeholder: 'Enter admin password',
              value: adminLoginAttempt,
              onChange: (evt) => setAdminLoginAttempt(evt.target.value),
              onKeyPress: (evt) => evt.key === 'Enter' && handleAdminLogin(),
              className: 'w-full bg-slate-600 text-white rounded px-3 py-2 mb-4 text-center'
            }),
            e('div', { className: 'space-y-2' },
              e('button', {
                className: 'w-full bg-red-600 hover:bg-red-500 text-white py-2 rounded font-bold',
                onClick: handleAdminLogin
              }, 'âœ“ Login'),
              e('button', {
                className: 'w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold',
                onClick: () => setShowForgotPassword(true)
              }, 'ðŸ”‘ Forgot Password'),
              e('button', {
                className: 'w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded font-bold',
                onClick: () => setShowPasswordPrompt(false)
              }, 'âœ• Cancel')
            )
          )
        );
      }

      // Forgot Password
      if (showForgotPassword) {
        return e('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4' },
          e('div', { className: 'bg-gradient-to-br from-slate-800 to-slate-900 border border-yellow-500/30 rounded-lg p-8 max-w-md w-full' },
            e('h2', { className: 'text-2xl font-bold text-yellow-400 mb-4 text-center' }, `Step ${recoveryStep}/3`),
            recoveryStep === 1 && e('div', { className: 'space-y-4' },
              e('p', { className: 'text-gray-300 mb-4 font-semibold' }, securitySetup.securityQuestion),
              e('input', {
                type: 'text',
                placeholder: 'Your answer',
                value: recoveryAttempt.securityAnswer,
                onChange: (evt) => setRecoveryAttempt({...recoveryAttempt, securityAnswer: evt.target.value}),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2'
              })
            ),
            recoveryStep === 2 && e('div', { className: 'space-y-4' },
              e('p', { className: 'text-gray-300 mb-4' }, 'Enter your 32-character recovery code:'),
              e('input', {
                type: 'text',
                placeholder: 'Recovery code',
                value: recoveryAttempt.recoveryCode,
                onChange: (evt) => setRecoveryAttempt({...recoveryAttempt, recoveryCode: evt.target.value}),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2 font-mono text-sm'
              })
            ),
            recoveryStep === 3 && e('div', { className: 'space-y-4' },
              e('input', {
                type: 'password',
                placeholder: 'New password (min 6 chars)',
                value: newPasswordSetup,
                onChange: (evt) => setNewPasswordSetup(evt.target.value),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2 mb-2'
              }),
              e('input', {
                type: 'password',
                placeholder: 'Confirm password',
                value: confirmPasswordSetup,
                onChange: (evt) => setConfirmPasswordSetup(evt.target.value),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2'
              })
            ),
            e('div', { className: 'space-y-2 mt-4' },
              e('button', {
                className: 'w-full bg-yellow-600 hover:bg-yellow-500 text-white py-2 rounded font-bold',
                onClick: handleForgotPassword
              }, recoveryStep === 3 ? 'âœ“ Reset Password' : 'Next'),
              e('button', {
                className: 'w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded font-bold',
                onClick: () => { setShowForgotPassword(false); setRecoveryStep(1); }
              }, 'Cancel')
            )
          )
        );
      }

      // Setup Security
      if (showSetupSecurity) {
        return e('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4' },
          e('div', { className: 'bg-gradient-to-br from-slate-800 to-slate-900 border border-blue-500/30 rounded-lg p-8 max-w-md w-full' },
            e('h2', { className: 'text-2xl font-bold text-blue-400 mb-6' }, 'ðŸ” Setup Security'),
            e('div', { className: 'space-y-4' },
              e('label', { className: 'block text-gray-300 text-sm' }, 'Security Question:'),
              e('input', {
                type: 'text',
                placeholder: 'e.g. What is your favorite drill bit brand?',
                value: securitySetup.securityQuestion,
                onChange: (evt) => setSecuritySetup({...securitySetup, securityQuestion: evt.target.value}),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2'
              }),
              e('label', { className: 'block text-gray-300 text-sm' }, 'Answer:'),
              e('input', {
                type: 'text',
                placeholder: 'Your answer (case-insensitive)',
                value: securitySetup.securityAnswer,
                onChange: (evt) => setSecuritySetup({...securitySetup, securityAnswer: evt.target.value}),
                className: 'w-full bg-slate-600 text-white rounded px-3 py-2'
              }),
              e('button', {
                className: 'w-full bg-blue-600 hover:bg-blue-500 text-white py-2 rounded font-bold',
                onClick: initializeSecurityQuestions
              }, 'âœ“ Setup'),
              e('button', {
                className: 'w-full bg-gray-600 hover:bg-gray-500 text-white py-2 rounded font-bold',
                onClick: () => setShowSetupSecurity(false)
              }, 'Cancel')
            )
          )
        );
      }

      // Main Layout
      return e('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white' },
        e('nav', { className: 'bg-slate-900 border-b border-blue-500/30 p-4 sticky top-0 z-10' },
          e('div', { className: 'max-w-7xl mx-auto flex items-center justify-between' },
            e('div', null,
              e('h1', { className: 'text-2xl font-bold text-blue-400' }, 'â›ï¸ Drill Rig Management'),
              e('p', { className: 'text-gray-400 text-sm' }, 'Pilgangoora Site - Pilbara Minerals')
            ),
            e('button', {
              className: 'bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded font-bold',
              onClick: () => setShowPasswordPrompt(true)
            }, 'ðŸ”“ Admin')
          )
        ),
        e('div', { className: 'max-w-7xl mx-auto p-4' },
          adminMode ? e(AdminPanel) :
          currentPage === 'fleet' ? e(FleetDashboard) :
          e(RigDetail)
        )
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(DrillRigManagementSystem));
  </script>
</body>
</html>
